@model HabitTracker.Models.HabitDetails

<h2>@Model.Habit.Name Calendar</h2>

<div class="calendar">
    <table>
        <thead>
        <tr>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
            <th>Sun</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var week in Model.CalendarWeeks)
        {
        <tr>
            @foreach (var day in week.Days)
            {
            <td class="@day.CssClass">
                @day.DayNumber
            </td>
            }
        </tr>
        }
        </tbody>
    </table>
</div>

<table class="table">
    <thead>
    <tr>
        <th>Date</th>
        <th>Completed</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    @{
    var startDate = DateTime.Now.AddDays(-30);
    var endDate = DateTime.Now;
    for (var date = startDate; date <= endDate; date = date.AddDays(1))
    {
    var record = Model.Habit.HabitRecords.FirstOrDefault(r => r.Date.Date == date.Date);
    <tr>
        <td>@date.ToShortDateString()</td>
        <td>@(record != null && record.IsCompleted ? "Yes" : "No")</td>
        <td>
            <form asp-action="ToggleCompletion" method="post">
                <input type="hidden" name="habitId" value="@Model.Habit.Id" />
                <input type="hidden" name="date" value="@date.ToString("yyyy-MM-dd")" />
                <input type="submit" value="Toggle" class="btn btn-primary" />
            </form>
        </td>
    </tr>
    }
    }
    </tbody>
</table>

<p>
    <a asp-action="Index">Back to List</a>
</p>

<style>
    .calendar {
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 10px;
    }

    .calendar table {
        width: 100%;
        border-collapse: collapse;
    }

    .calendar th,
    .calendar td {
        border: 1px solid #ccc;
        text-align: center;
        padding: 5px;
    }

    .calendar .marked {
        background-color: lightgreen;
    }

    .calendar .not-marked {
        background-color: lightgray;
    }

    .calendar .previous-month {
        color: #ccc;
    }

</style>
